# HK家計簿

> このソフトを猪山直之に倍返しで捧げます。

このソフトは私個人のためにつくった家計簿ソフトです。シンプルで機能が少ないので、あまり買い物をしなくて、必要に応じてソフトを改造したい方（プログラマ、ひきこもり、NEET等）に向いています。

![Screenshot transactions](https://raw.githubusercontent.com/ivan111/screenshots/master/mita/transactions.png "スクリーンショット 取引")

![Screenshot balance](https://raw.githubusercontent.com/ivan111/screenshots/master/mita/balance.png "スクリーンショット 残高")

![Screenshot chart](https://raw.githubusercontent.com/ivan111/screenshots/master/mita/chart.png "スクリーンショット グラフ")


## 特徴

- 収入／費用または資産／負債を月・年単位のグラフでみれる
- 年払いのものを12ヶ月に自動配分できる
- Linux, Windows 等で動作する
- コマンドラインから実行して、ブラウザで操作する


## 必要なスキル

- 収入・費用・資産・負債の違いがわかる（わからない方でもネット検索して調べればすぐにわかるようになると思います。そんなに難しい知識は必要ありません）
- インストールするガッツ（パソコンが苦手な人にはソフトを起動するまでが難しいと思います）
- 改造したいならプログラミングスキル
- バグを怖がらない勇気


## インストール

コマンドは Ubuntu での実行を例にしています。

まず Python3 をインストールしてください。

```sh
sudo apt install python3 python3-pip python3-venv
```

venv などで仮想環境をつくりたいならつくってください。ここは省略可。

```sh
python3 -m venv mita
cd mita
source bin/activate
```

Python 3 に flask(バージョン1以上) と dateutil をインストールしてください。

```sh
pip3 install flask python-dateutil
```

このページの右上のボタンで zip をダウンロードしたり、git コマンドでソフトをダウンロードしてください。zip をダウンロードした人はそれを解凍します。

```sh
git clone https://github.com/ivan111/mita
```

ダウンロードしたディレクトリに移動。

```sh
cd mita
```

データベースの初期化

```sh
flask initdb
```

勘定科目を設定するために accounts.tsv を書き換えてください。
勘定科目はソフトを起動したあとからでも修正できます。

以下のコマンドで、使用する勘定科目を読み込みます。

```sh
flask import_accounts accounts.tsv
```

他のソフトからデータを移したいなら、transactions.tsv に取引データを書き込んでください。
その場合は、自分で tsv を作るスクリプトを書いてください。
tsv の形式は transactions.tsv の中を見てください(先頭の#はコメントです)。

以下のコマンドで、使用する取引を読み込みます。

```sh
flask import_transactions transactions.tsv
```

起動するには以下のコマンドを実行します。

```sh
flask run
```

ブラウザを立ち上げて、以下のURLを入力すると家計簿ソフトが見れます。

http://127.0.0.1:5000/

左上の「取引」リンクをクリック。「追加」リンクをクリック。そこから、資産と負債の開始残高を登録してください。たとえば、借方に現金、貸方に開始残高を設定します。


## 使い方

シンプルなので使いながら使い方を覚えてください。

注意点としては、グラフを表示するとき、収入・費用のときは開始・終了を入力した取引が分配されるが、資産・負債のときは分配されないことです。あと分配によって数円の誤差がでることがありますが、気にしないでください。


## ずぼら家計簿のすすめ

私が家計簿をつける目的は、何にどれくらい使っているのかをおおざっぱに理解するためです。なので、現金は紙幣のみ管理しています。

たとえば、パンを100円で買って、千円札で払ったら、

```
食費／現金 1,000
```

と入力します。もし 100円玉で買っていたら、紙幣は使ってないので家計簿には何も記入しません。

食費(200円)と書籍(600円)を同時に購入して千円札で払った場合は、金額の大きい書籍のみを借方に書きます。

小さい金額を正確に入力してもメリットよりも、管理のための手間が増えるデメリットのほうが大きくなります。

私は紙幣だけの管理をしているのですが、それでも記入忘れでときどき実際の現金と家計簿の現金残高が合わなくなります。硬貨まで管理していたら、たぶん家計簿が続いてなかったと思います。

私はオールドタイプなので現金での支払いをよくしてますが、電子マネーやカードで買っている人には関係ない話でした。


## ファイルの説明

- account.py : 勘定科目class
- accounts.tsv : 最初の勘定科目例が入ったタブ区切りデータ
- ac\_view.py : 勘定科目のCRUD処理
- app.py : flaskアプリ。いつもここから
- balance\_view : 残高ビュー
- chart\_view : グラフビュー。グラフで必要になる tsv を返すのもここ
- db.py : データベース接続
- db.sqlite3 : データベース (勘定科目テーブル(accounts)と取引テーブル(transactions))
- exportdb.py : tsv(タブ区切り)でデータをエクスポートする処理
- importdb.py : tsv(タブ区切り)のデータをインポートする処理
- initdb.py : データベースにテーブルを作る
- transaction.py : 取引class
- transactions.py : 取引例が入ったタブ区切りデータ
- tr\_view.py : 取引のCRUD処理

- templates/\*.html : テンプレート

- static/js/chart.js : stacked-chart.js を使ってグラフを表示する
- static/js/stacked-chart.js : 積立棒グラフ


## その他メモ

給与は所得税や年金や健康保険などの控除も入力してたほうがいいと思います。そのほうが、実際にかかっている費用を実感できる。給与を手取りだけで入力すると、無職になって年金や健康保険を家計簿に入力するようになると働いてたときよりも費用がかかっているように見えてしまう（経験者として私は助言しておきます）。

私個人のためにつくっているというのと、改造することを前提につくっているので Python パッケージにしてません。コンパイルせずに気軽に改造できる喜びを味わってください。
